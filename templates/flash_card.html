<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        
        <title>Game Chooser</title>
        <style>
            html, body{
                height: 100%;
            }
            .flip-card {
                background-color: transparent;
                width: 100%;
                height: 500px;
                perspective: 1000px;
            }

            .flip-card-inner {
                position: relative;
                width: 100%;
                height: 100%;
                text-align: center;
                transition: transform 0.6s;
                transform-style: preserve-3d;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
            }

            .flip-card:hover .flip-card-inner {
                transform: rotateX(180deg);
            }

            .flip-card-front,
            .flip-card-back {
                position: absolute;
                width: 100%;
                height: 100%;
                -webkit-backface-visibility: hidden; /*Safari*/
                backface-visibility: hidden;
            }

            .flip-card-front {
                background-color: #bbb;
                color: black;
            }

            .flip-card-back {
                background-color: #2980b9;
                color: white;
                transform: rotateX(180deg);
            }
        </style>
    </head>
    <body>
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">Word_Card</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../home">主選單列</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../set_index">開始學習</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../create_set">建立學習集</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../modify_set">修改學習集</a>
                    </li>
                </ul>
              
                <!--<form class="form-inline my-2 my-lg-0">
                    <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                </form>-->
                <ul class="navbar-nav ml-auto">
                  <li class="nav-item">
                    <button class="nav-link" id="login_out">Login Out</a>
                  </li>
                </ul>
            </div>
        </nav>
        <!-- Flash cards -->
        <div class = "container h-100" style="height: 100px; ">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel" data-interval="false">
                <div id="indicators_play">
                    <!--sample
                    <ol class="carousel-indicators" >
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                    </ol>
                    -->
                </div>


                <div id="item_play">
                    <!--sample
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <div class="flip-card">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <button type="button" class="btn btn-outline-secondary d-block w-100" style="height:500px;">Computer Communication and Consumer Electronics 電腦 通訊 及 消費者 電子 產品</button>
                                    </div>
                                    <div class="flip-card-back">
                                        <button type="button" class="btn btn-outline-secondary d-block w-100" style="height:500px;">3C</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="carousel-item">
                          <div class="flip-card">
                              <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <button type="button" class="btn btn-outline-secondary d-block w-100" style="height:500px;">Asymmetric Digital Subscriber 使用 電話 線 寬頻 上網 的 技術</button>
                                    </div>
                                    <div class="flip-card-back">
                                        <button type="button" class="btn btn-outline-secondary d-block w-100" style="height:500px;">ADSL</button>
                                    </div>
                              </div>
                          </div>
                        </div>
                    
                        <div class="carousel-item">
                          <div class="flip-card">
                              <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <button type="button" class="btn btn-outline-secondary d-block w-100" style="height:500px;">Artificial Intelligence 人工智慧</button>
                                    </div>
                                    <div class="flip-card-back">
                                        <button type="button" class="btn btn-outline-secondary d-block w-100" style="height:500px;">AI</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    -->
                </div>

                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
              </div>
        <!-- </div> -->
        
        <!-- Definitions of vocabularies from the Flash cards -->
            <br>
            <br>
            <div class = "container">

                <div class="row align-items-stretch ">
                    <div class="row col-md-4">
                        <img id = "creatorImg" src = "../static/fix.png" height = "30px"/>
                        <p>資料集建立者 : </p>
                        <p id = "lab_workers"></p>
                    </div>
                    <div class="row col-md-4">
                        <img id = "creatorImg" src = "../static/fix.png" height = "30px"/>
                        <p id = "cardSetName">資料集名稱 : </p>
                        <p id = "lab_names"></p>
                    </div>
                    <div class="row col-md-4">
                        <img id = "creatorImg" src = "../static/fix.png" height = "30px"/>
                        <p>本學習集中的詞語數 : </p>
                        <p id="lab_numbers"></p>
                    </div>
                </div>
                <div id="word_column">
                    <!--單字條列展示區-->
                    <!--範例
                    <div class = "row align-items-center ">
                        <div class="card mb-0 container-fluid">
                            <div class="row align-items-center">
                                <div class="col-md-4 align-items-center d-flex justify-content-center">
                                    <h3 class="card-text">3C</h3>
                                </div>
                                <div class="col-md-8 bg-light border border-dark">
                                    <div class="card-body ">
                                        <p class="card-text">Computer Communication and Consumer Electronics</p>
                                        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    -->
                </div>
            </div>
        </div>
        
            
        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
        <script>
            let lab_name="";
            let lab_file=NaN;
            $(document).ready(start);
            function start(){
                if(localStorage.getItem("word_card_email")== null){
                    location.href='sign';
                }
                token_verify();
                $("#login_out").on("click", login_out);
                lab_name = {{ _lab_name|tojson }};
                console.log("lab_name is: "+lab_name);
                get_lab_word();
                //alert(lab_name);
            }
            function login_out(){
              $.ajax({
                url: "/loginout",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ 'email': localStorage.getItem("word_card_email") , 'token': localStorage.getItem("word_card_token")}),
                success: function(response) {
                    localStorage.clear();
                    location.href='/';
                }
              });
            }
            function token_verify(){
                $.ajax({
                    url: "/token_verify",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ 'email': localStorage.getItem("word_card_email") , 'token': localStorage.getItem("word_card_token") }),
                    success: function(response) {
                        if(response["message"]!="true"){
                            alert("帳號異常，請從新登入");
                            localStorage.clear();
                            location.href='/';
                        }
                    }
                });
            }
            function get_lab_word(){
                $.ajax({
                url: "/get_lab",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ 'email': localStorage.getItem("word_card_email") , 'token': localStorage.getItem("word_card_token") , 'name' : lab_name}),
                success: function(response) {
                    for(let i=0;i<response["number"];i++){
                        console.log(response[String("word_"+i)],response[String("define_"+i)]); 
                        add_word_column(response[String("word_"+i)],response[String("define_"+i)],response["time"]);                                
                    }
                    lab_inf_update(localStorage.getItem("word_card_email"),lab_name,response["number"]);
                    indicators_play(response["number"]);
                    item_play(response);
                    lab_file=response;
                    console.log(lab_file);
                    
                }
                });
            }
            function lab_inf_update(worker,name,number){
                $("#lab_workers").html(worker);
                $("#lab_names").html(name);
                $("#lab_numbers").html(number);
            }
            function add_word_column(word,define,time){
                let str="";
                str += "<div class = 'row align-items-center '>                                                                ";                             
                str += "    <div class='card mb-0 container-fluid'>                                                            ";                              
                str += "        <div class='row align-items-center'>                                                           ";                                
                str += "            <div class='col-md-4 align-items-center d-flex justify-content-center'>                    ";                                           
                str += "                <h3 class='card-text'>"+word+"</h3>                                                    ";                               
                str += "            </div>                                                                                     ";                                      
                str += "            <div class='col-md-8 bg-light border border-dark'>                                         ";                                  
                str += "                <div class='card-body '>                                                               ";                               
                str += "                    <p class='card-text'>"+define+"</p>                                                ";              
                str += "                    <p class='card-text'><small class='text-muted'>Last updated "+time+"</small></p> ";                                            
                str += "                </div>                                                                                 ";                              
                str += "            </div>                                                                                     ";                                     
                str += "        </div>                                                                                         ";                           
                str += "    </div>                                                                                             ";                            
                str += "</div>                                                                                                 ";
                $("#word_column").append(str);                                                                                       
            }
            function indicators_play(number){
                console.log("number"+number);
                let str="";
                str += "<ol class='carousel-indicators' >                                                        ";                                            
                str += "    <li data-target='#carouselExampleIndicators' data-slide-to='0' class='active'></li>  ";  
                for(let i=1 ;i<number ;i++){
                    str += "    <li data-target='#carouselExampleIndicators' data-slide-to='"+i+"'></li>         ";
                }          
                str += "</ol>                                                                                    ";      
                $("#indicators_play").html(str);                                                                                                                        
            }
            function item_play(response){
                console.log(response["number"]);
                let str="";
                str += " <div class='carousel-inner'>                                                                                                                                                                          ";    
                
                str += "     <div class='carousel-item active'>                                                                                                                                                                 ";                        
                str += "         <div class='flip-card'>                                                                                                                                                                        ";                        
                str += "             <div class='flip-card-inner'>                                                                                                                                                              ";                                
                str += "                 <div class='flip-card-front'>                                                                                                                                                          ";                    
                str += "                     <button type='button' class='btn btn-outline-secondary d-block w-100' style='height:500px;'>"+response[String("word_0")]+"</button>                                                 ";                                        
                str += "                 </div>                                                                                                                                                                                 ";                        
                str += "                 <div class='flip-card-back'>                                                                                                                                                           ";                    
                str += "                     <button type='button' class='btn btn-outline-secondary d-block w-100' style='height:500px;'>"+response[String("define_0")]+"</button>                                              ";                                
                str += "                 </div>                                                                                                                                                                                 ";                        
                str += "             </div>                                                                                                                                                                                     ";                
                str += "         </div>                                                                                                                                                                                         ";                            
                str += "     </div>                                                                                                                                                                                             ";                                                                                                                                                                                                                                          
                
                for (let i = 1;i < response["number"];i++){
                    console.log("go in here");
                    str += "     <div class='carousel-item'>                                                                                                                                                                        ";                                
                    str += "       <div class='flip-card'>                                                                                                                                                                          ";                        
                    str += "           <div class='flip-card-inner'>                                                                                                                                                                ";                            
                    str += "                 <div class='flip-card-front'>                                                                                                                                                          ";                            
                    str += "                     <button type='button' class='btn btn-outline-secondary d-block w-100' style='height:500px;'>"+response[String("word_"+i)]+"</button>                                               ";                                            
                    str += "                 </div>                                                                                                                                                                                 ";                                
                    str += "                 <div class='flip-card-back'>                                                                                                                                                           ";                                    
                    str += "                     <button type='button' class='btn btn-outline-secondary d-block w-100' style='height:500px;'>"+response[String("define_"+i)]+"</button>                                             ";                            
                    str += "                 </div>                                                                                                                                                                                 ";                            
                    str += "           </div>                                                                                                                                                                                       ";                                
                    str += "       </div>                                                                                                                                                                                           ";                                    
                    str += "     </div>                                                                                                                                                                                             ";                            
                }
                
                str += "                                                                                                                                                                                                        ";                                    
                str += " </div>                                                                                                                                                                                                 ";                                        
                $("#item_play").html(str);
            }
        </script>
    </body>
</html>
  